{% extends 'feedback/home.html' %}
{% load humanize %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block feedback_page_header %}

{% endblock %}

{% block feedback_content %}
<nav>
  <ul class="pager">
    <li class="previous"><a href="{% url 'feedback_list' %}"><span aria-hidden="true">&larr;</span> Back to Issues List</a></li>
    <!--<li class="next"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>-->
  </ul>
</nav>
<blockquote>
    <h3>{{ feedback.summary }}</h3>
    <p>{{ feedback.description }}</p>
    {% if feedback.reference %}
        <div class="alert alert-info" role="alert" style="font-size: 75%;"><strong>Reference </strong> <a href="{{ feedback.reference }}" target="_blank"> {{ feedback.reference }}</a></div>
    {% endif %}
    <p class="pull-right">
        <span class="label label-warning" data-toggle="tooltip" data-placement="top" title="Vote up">
            <a href="{% url 'vote' %}?feedback_id={{ feedback.id }}&voted=true" id="vote_up_link" style="color: white;"><span class="glyphicon glyphicon-thumbs-up"></span>&nbsp;</a>
            <span id="votes_up_count">{{ feedback.votes_up }}</span>
        </span>
        &nbsp;
        <span class="label label-warning" data-toggle="tooltip" data-placement="top" title="Vote down">
            <a href="{% url 'vote' %}?feedback_id={{ feedback.id }}&voted=false" id="vote_dn_link" style="color: white;"><span class="glyphicon glyphicon-thumbs-down"></span>&nbsp;</a>
            <span id="votes_dn_count">{{ feedback.votes_dn }}</span>
        </span>
    </p>
    <div class="clearfix"></div>
    <p><small>Reported by {{ feedback.created_by }} on {{ feedback.created }}</small></p>
</blockquote>



<h1>Threaded Comments</h1>
    {% crispy form %}
    <ul id="commenters">
    {% for c in comment_tree %}     
        <li id="{{c.id}}" class="c" style="margin-left:{{c.depth|add:c.depth}}em;">
            <p class="poster">Anonymous - {{c.date|naturaltime}}</p>
            <p>{{c.content}}</p>
            <p><a href="" class="reply">reply</a></p>
        </li>
    {% empty %}
        <li>There are currently no comments. You can be first!</li>
    {% endfor %}
    </ul>

{% endblock feedback_content %}


{% block feedback_extra_js %}
<script type = "text/javascript">
    "use strict";

    $('blockquote').on('click', '#vote_up_link', function(e) {
        e.preventDefault();
        $.post($(this).attr('href'))
            .done(function(data, textStatus, jqXHR) {
                $("#votes_dn_count").text(data['votes_dn_count']);
                $("#votes_up_count").text(data['votes_up_count']);
            });
        
    });

    $('blockquote').on('click', '#vote_dn_link', function(e) {
        e.preventDefault();
        $.post($(this).attr('href'))
            .done(function(data, textStatus, jqXHR) {
                $("#votes_dn_count").text(data['votes_dn_count']);
                $("#votes_up_count").text(data['votes_up_count']);
            });
    });

    $(document).ready(function(){
        $("#commenters").on("click", ".reply", function(event){
            event.preventDefault();
            var form = $("#id_comment_form").clone(true);
            form.find('.parent').val($(this).parent().parent().attr('id'));
            $(this).parent().append(form);
        });
    });
</script>
{% endblock feedback_extra_js %}