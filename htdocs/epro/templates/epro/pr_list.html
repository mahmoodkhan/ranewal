{% extends 'epro/home.html' %}
{% load staticfiles %}
{% block epro_content %}
<div class="panel panel-primary">
    <div class="panel-heading">
        <div role="group" class="btn-group btn-group-xs pull-right">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class= "glyphicon glyphicon-menu-hamburger"> </span>
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li><a href="{% url 'pr_new' %}" id='add_new_pr_link' class="text-muted" style="color: #006400 !important;"><span class="glyphicon glyphicon-plus"></span> New PR for Goods</a></li>
                <li class="divider"></li>
                <li><a href="#" id="pr_cancel_btn" class="text-muted" style="color: #b30000 !important;"><span class="glyphicon glyphicon-exclamation-sign"></span> Cancel</a></li>
            </ul>
        </div>
        <h3 class="panel-title">Purchase Request List</h3>
        <div class="clearfix"></div>
    </div>
    
    <div class="panel-body">
        <div class="table-responsive">
            <table id="prs_table" class="table table-bordered table-striped table-hover table-condensed">
                <thead>
                    <tr>
                        <th>PR No</th>
                        <th>Project Reference</th>
                        <th>Delivery Address</th>
                        <th>Required Date</th>
                        <th>Status</th>
                        <th>Approver 1</th>
                        {% if pr.approver2 %}
                            <th>Approver 2</th>
                        {% endif %}
                        <th style="width:18px;"></th>
                    </tr>
                </thead>
                <!--
                <tfoot>
                    <tr>
                        <td colspan="7"></td>
                    </tr>
                </tfoot>
                -->
                <tbody>
                {% for pr in prs %}
                    <tr>
                        <td><a href="{% url 'pr_view' pr.pk %}">{{ pr.office }}-{{ pr.sno }}</a></td>
                        <td>{{ pr.project_reference }}</td>
                        <td>{{ pr.delivery_address|default_if_none:'' }}</td>
                        <td>{{ pr.required_date|date }}</td>
                        <td>{{ pr.status }}</td>
                        <td>{{ pr.approver1 }}</td>
                        {% if pr.approver2 %}
                            <td>{{ pr.approver2 }}</td>
                        {% endif %}
                        <td>
                            <a href="{% url 'pr_edit' pr.pk %}" id='edit_pr_link'><span class="glyphicon glyphicon-edit"></span></a>
                            <a href="#" data-href="/pr/delete/1/" data-toggle="modal" data-target="#confirm-delete" style="color:red;"><span class="glyphicon glyphicon-trash"></span></a>
                        </td>
                    </tr>
                {% empty %}
                    There are no Purchase Requests to show.
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock epro_content %}

{% block epro_extra_js %}
<script type="text/javascript">
"use strict";
    $(document).ready(function() {
        $("#prs_table").DataTable();
        /*
        setTimeout(function(){
            $("#prs_table").DataTable();
        }, 3000); 
        */
    });

    $('body').on('click', 'a#edit_pr_link', function(e) {
        e.preventDefault();
        $("#app_modal_div_content_div").load($(this).attr("href"));
        $('#app_modal_div').modal('show');
    });

</script>
{% endblock epro_extra_js %}