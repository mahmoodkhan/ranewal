{% load crispy_forms_tags %}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h4 class="modal-title">{% if item.pk %} Updating Item {% else %} Adding Item {% endif %}</h4>
    <span id="modal_messages"></span>
</div>
<div class="modal-body">
    <!-- Nav tabs -->
    <ul id="pr_items_tabs_ul" class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
            <a href="#item_tab" aria-controls="item_form" role="tab" data-toggle="tab"> Item</a>
        </li>
        <li role="presentation">
            <a href="#financecodes_tab" aria-controls="finance_codes_form" role="tab" data-toggle="tab"> Finance Codes</a>
        </li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="item_tab"><br />{% crispy form %}</div>
        <div role="tabpanel" class="tab-pane" id="financecodes_tab">
            <div class = "table-responsive">
                <table id="finance_codes_table" class="table table-bordered table-striped table-hover table-condensed">
                    <tr>
                        <th style="display:none;">item_id</th>
                        <th style="display:none;">finance_codes_id</th>
                        <th>GL</th>
                        <th>Fund</th>
                        <th>Dept</th>
                        <th>Office</th>
                        <th>LIN</th>
                        <th>Activity</th>
                        <th>Emp ID</th>
                        <th>% Alloc</th>
                        <th></th>
                    </tr>
                    {% for fc in item.finance_codes.all %}
                        <tr>
                            <td style="display:none;"> {{ item.pk }} </td>
                            <td style="display:none;"> {{ fc.pk }} </td>
                            <td> {{ fc.gl_account }} </td>
                            <td> {{ fc.fund_code }} </td>
                            <td> {{ fc.dept_code }} </td>
                            <td> {{ fc.office_code }} </td>
                            <td> {{ fc.lin_code }} </td>
                            <td> {{ fc.activity_code }} </td>
                            <td> {{ fc.employee_id }} </td>
                            <td> {{ fc.allocation_percent }} </td>
                            <td>
                                <a href="{% url 'financecodes_edit' fc.pk %}" data-finance-codes-id={{ fc.pk }} class="edit"><span class="glyphicon glyphicon-edit"></span></a>
                                <a href={% url 'financecodes_edit' fc.pk %} data-finance-codes-id={{ fc.pk }} class="del" style="color:red;"><span class="glyphicon glyphicon-trash"></span></a>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
            {% crispy finance_codes_form %}
    </div>
</div>
{% block extra_js %}
<script type = "text/javascript">

    // Upon activating the Item tab, set the quantity field on focus.
    $('#pr_items_tabs_ul a[href="#item_tab"]').on('shown.bs.tab', function (e) {
        $("#id_quantity_requested").focus();
    });

    // Upon activating the FinanceCodes tab, set the GL_Account field on focus.
    $('#pr_items_tabs_ul a[href="#financecodes_tab"]').on('shown.bs.tab', function (e) {
        $("#id_gl_account").focus();
    });

    // Upon clicking the EDIT button FinanceCodes, update the FinanceCodes action url
    $('#finance_codes_table').on('click', 'a.edit', function(e) {
        e.preventDefault();
        //var finance_codes_pk = $(this).data("financeCodesId");
        $("#id_finance_codes_form").attr("action",  $(this).attr('href'));

        // ToDo: Populate the form with values from the table row above.
    });

    // Upon clicking the Cancel button of the FinanceCodes form, set the FinanceCodes form action to add
    $("#id_finance_codes_form").on("click", "#id_cancel_finance_codes_btn", function(e) {
        $("#id_finance_codes_form").attr("action",  "{% url 'financecodes_new' item.pk %}");
        // ToDo: Empty the form
    });

</script>
{% endblock extra_js %}